<ng-template #customCellTemplate let-day="day" let-locale="locale">
    <div class="cal-cell-top">
        <span class="cal-day-badge" *ngIf="day.badgeTotal > 0">{{
      day.badgeTotal
    }}</span>
        <span class="cal-day-number" style="opacity: 0.3">{{
      day.date | calendarDate: "monthViewDayNumber":locale
    }}</span>
    </div>
    <div class="cell-totals">
        <span *ngFor="let group of day.eventGroups" class="badge badge-{{ group[0] }}">
      {{ group[1].length }}
    </span>
    </div>
</ng-template>

<div class="container-fluid">
    <div class="row">
        <div class="col-lg-12">
            <!--Card Start-->
            <div class="card">
                <!--Card Body-->
                <div class="card-body">
                    <!--Searching-->
                    <div class="row">
                        <div class="col-md-3">
                            <mat-form-field class="search">
                                <mat-icon matPrefix>search</mat-icon>
                                <input #in type="text" matInput placeholder="Search" />
                            </mat-form-field>
                        </div>
                        <div class="col-md-3">
                            <mat-form-field class="search">
                                <mat-select [(ngModel)]="zipCode" placeholder="Zip Code">
                                    <mat-option *ngFor="let zipCode of zipCodeList" [value]="zipCode.name" (onSelectionChange)="selectZipcode($event, zipCode.name)">{{ zipCode.name }}</mat-option>
                                </mat-select>
                            </mat-form-field>
                        </div>
                        <div class="col-md-3">
                            <mat-form-field class="search">
                                <mat-select [(ngModel)]="centerId" placeholder="Site">
                                    <mat-option *ngFor="let center of centerList" [value]="center.id" (onSelectionChange)="selectCenter($event, center.id)">{{ center.name }}</mat-option>
                                </mat-select>
                            </mat-form-field>
                        </div>
                        <div class="col-md-3">
                            <mat-form-field class="search">
                                <mat-select [(ngModel)]="taxTypeId" placeholder="Tax Type">
                                    <mat-option *ngFor="let taxType of taxTypeList" [value]="taxType.id" (onSelectionChange)="selectTaxType($event, taxType.id)">{{ taxType.name }}</mat-option>
                                </mat-select>
                            </mat-form-field>
                        </div>
                    </div>
                    <!--Searching End-->

                    <!--Calendar View Start-->
                    <div class="container-">
                        <div class="row" style="justify-content: center; margin-top: 15px">
                            <div class="col-md-12">
                                <div class="card-header card-header-danger" style="padding: 10px; margin-bottom: 10px">
                                    <h4 class="card-title">
                                        Site Name {{ centerName != undefined ? " : " + centerName : "" }}
                                        <button mat-button class="btn btn-success" matTooltip="Download Report" [matTooltipPosition]="'below'" (click)="results()" style="float: right; padding: 3px 10px 2px 10px">
                      <i class="material-icons">cloud_download</i>
                    </button>
                                    </h4>
                                </div>
                            </div>

                            <div class="col-md-12">
                                <div class="row text-center">
                                    <div class="col-md-4">
                                        <div class="btn-group">
                                            <div class="btn btn-primary" *ngIf="showPreviousButton" mwlCalendarPreviousView [view]="view" [(viewDate)]="viewDate" (viewDateChange)="closeOpenMonthViewDay()" (click)="previousNextSummary(viewDate, 'previous')" style="height: 42px">
                                                Previous
                                            </div>
                                            <div class="btn btn-outline-secondary" mwlCalendarToday [(viewDate)]="viewDate">
                                                Today
                                            </div>
                                            <div class="btn btn-primary" mwlCalendarNextView [view]="view" [(viewDate)]="viewDate" (viewDateChange)="closeOpenMonthViewDayNext()" (click)="previousNextSummary(viewDate, 'next')">
                                                Next
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4" style="margin-top: 15px">
                                        <h3>
                                            {{ viewDate | calendarDate: view + "ViewTitle":"en" }}
                                        </h3>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="btn-group">
                                            <div class="btn btn-primary" (click)="setView(CalendarView.Month, 'month')" [class.active]="view === CalendarView.Month" style="height: 41px">
                                                Month
                                            </div>
                                            <div class="btn btn-primary" (click)="setView(CalendarView.Week, 'week')" [class.active]="view === CalendarView.Week" style="height: 40px">
                                                Week
                                            </div>
                                            <div class="btn btn-primary" (click)="setView(CalendarView.Day, 'day')" [class.active]="view === CalendarView.Day" style="height: 4lpx">
                                                Day
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="container-fluid" style="padding-left: 10px; padding-right: 10px">
                                    <div class="row text-left">
                                        <div class="col-md-12">
                                            <mat-spinner *ngIf="summaryData.loading$ | async" diameter="32"></mat-spinner>
                                            <div class="example-container mat-elevation-z8" *ngIf="summaryData" style="margin-bottom: 10px">
                                                <table mat-table [dataSource]="summaryData" class="table table-striped">
                                                    <ng-container matColumnDef="sr_no">
                                                        <th mat-header-cell *matHeaderCellDef class="tableHeader" style="padding: 2px; color: black">
                                                            Sr No.
                                                        </th>
                                                        <td mat-cell *matCellDef="let element; let i = index" class="tableBody" style="padding: 2px">
                                                            {{ i + 1 }}
                                                        </td>
                                                    </ng-container>

                                                    <ng-container matColumnDef="total_appointments">
                                                        <th mat-header-cell *matHeaderCellDef class="tableHeader" style="color: black">
                                                            Total Appointments
                                                        </th>
                                                        <td mat-cell *matCellDef="let element" class="tableBody">
                                                            {{ element.total_appointments }}
                                                        </td>
                                                    </ng-container>

                                                    <ng-container matColumnDef="tax_preparer_count">
                                                        <th mat-header-cell *matHeaderCellDef class="tableHeader" style="color: black">
                                                            Tax Preparer
                                                        </th>
                                                        <td mat-cell *matCellDef="let element" class="tableBody">
                                                            {{ element.tax_preparer_count }}
                                                        </td>
                                                    </ng-container>

                                                    <ng-container matColumnDef="document_drop_off_count">
                                                        <th mat-header-cell *matHeaderCellDef class="tableHeader" style="
                                background-color: rgb(129, 205, 93);
                                color: black;
                              ">
                                                            Document Drop off
                                                        </th>
                                                        <td mat-cell *matCellDef="let element" class="tableBody">
                                                            {{ element.document_drop_off_count }}
                                                        </td>
                                                    </ng-container>

                                                    <ng-container matColumnDef="basic_in_person_count">
                                                        <th mat-header-cell *matHeaderCellDef class="tableHeader" style="
                                background-color: rgb(129, 216, 201);
                                color: black;
                              ">
                                                            Basic in Person
                                                        </th>
                                                        <td mat-cell *matCellDef="let element" class="tableBody">
                                                            {{ element.basic_in_person_count }}
                                                        </td>
                                                    </ng-container>

                                                    <ng-container matColumnDef="advance_in_person_count">
                                                        <th mat-header-cell *matHeaderCellDef class="tableHeader" style="
                                background-color: rgb(94, 150, 255);
                                color: black;
                              ">
                                                            Advance In Person
                                                        </th>
                                                        <td mat-cell *matCellDef="let element" class="tableBody">
                                                            {{ element.advance_in_person_count }}
                                                        </td>
                                                    </ng-container>

                                                    <ng-container matColumnDef="return_visit_count">
                                                        <th mat-header-cell *matHeaderCellDef class="tableHeader" style="
                                background-color: rgb(129, 126, 205);
                                color: black;
                              ">
                                                            Return Visit
                                                        </th>
                                                        <td mat-cell *matCellDef="let element" class="tableBody">
                                                            {{ element.return_visit_count }}
                                                        </td>
                                                    </ng-container>

                                                    <ng-container matColumnDef="total_hours">
                                                        <th mat-header-cell *matHeaderCellDef class="tableHeader" style="
                                background-color: #c5c5c7 !important;
                                color: black;
                              ">
                                                            Total Hours
                                                        </th>
                                                        <td mat-cell *matCellDef="let element" class="tableBody">
                                                            {{ element.total_hours }}
                                                        </td>
                                                    </ng-container>

                                                    <ng-container matColumnDef="total_hours_booked">
                                                        <th mat-header-cell *matHeaderCellDef class="tableHeader" style="
                                background-color: #c5c5c7 !important;
                                color: black;
                              ">
                                                            Total Hours Booked
                                                        </th>
                                                        <td mat-cell *matCellDef="let element" class="tableBody">
                                                            {{ element.total_hours_booked }}
                                                        </td>
                                                    </ng-container>

                                                    <ng-container matColumnDef="booking_percentage">
                                                        <th mat-header-cell *matHeaderCellDef class="tableHeader" style="
                                background-color: #c5c5c7 !important;
                                color: black;
                              ">
                                                            Booking Percentage
                                                        </th>
                                                        <td mat-cell *matCellDef="let element" class="tableBody">
                                                            {{ element.booking_percentage }}
                                                        </td>
                                                    </ng-container>

                                                    <ng-container matColumnDef="total_hours_available">
                                                        <th mat-header-cell *matHeaderCellDef class="tableHeader" style="
                                background-color: #c5c5c7 !important;
                                color: black;
                                text-align: center;
                                padding-right: 0px;
                              ">
                                                            Total Hours Available
                                                        </th>
                                                        <td mat-cell *matCellDef="let element" class="tableBody">
                                                            {{ element.total_hours_available }}
                                                        </td>
                                                    </ng-container>

                                                    <tr mat-header-row *matHeaderRowDef="this.displayedColumns"></tr>
                                                    <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
                                                </table>

                                                <!-- <mat-paginator
                                          *ngIf="summaryData.page$ | async as page"
                                          [length]="page.totalElements"
                                          [pageSize]="page.size"
                                          [pageIndex]="page.number"
                                          [hidePageSize]="false"
                                          (page)="summaryData.fetch($event.pageIndex)"
                                        >
                                        </mat-paginator> -->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row" style="justify-content: end; margin-bottom: 4px">
                                    <div class="col-md-3 col-3 text-center">
                                        <div class="btn btn-primary" (click)="setToogelView()">
                                            <ng-container *ngIf="!toogleDetailView">
                                                <span class="material-icons"> add </span> Show more
                                            </ng-container>
                                            <ng-container *ngIf="toogleDetailView">
                                                <span class="material-icons"> remove </span> Show less
                                            </ng-container>
                                        </div>
                                    </div>
                                </div>
                                <div class="container-fluid" style="padding-left: 10px; padding-right: 10px" *ngIf="
                    appointmentSummaryForTaxPrepearerList != undefined &&
                    appointmentSummaryForTaxPrepearerList.length > 0 &&
                    toogleDetailView
                  ">
                                    <div class="row text-left">
                                        <div class="col-md-12">
                                            <mat-spinner *ngIf="taxSummaryData.loading$ | async" diameter="32"></mat-spinner>
                                            <div class="example-container mat-elevation-z8" *ngIf="taxSummaryData" style="margin-bottom: 10px">
                                                <table mat-table [dataSource]="taxSummaryData" class="table table-striped">
                                                    <ng-container matColumnDef="sr_no">
                                                        <th mat-header-cell *matHeaderCellDef class="tableHeader" style="padding: 2px; color: black">
                                                            Sr No.
                                                        </th>
                                                        <td mat-cell *matCellDef="let element; let i = index" class="tableBody" style="padding: 2px">
                                                            {{ i + 1 }}
                                                        </td>
                                                    </ng-container>

                                                    <ng-container matColumnDef="total_appointments">
                                                        <th mat-header-cell *matHeaderCellDef class="tableHeader" style="color: black">
                                                            Total Appointments
                                                        </th>
                                                        <td mat-cell *matCellDef="let element" class="tableBody">
                                                            {{ element.total_appointments }}
                                                        </td>
                                                    </ng-container>

                                                    <ng-container matColumnDef="tax_preparer_count">
                                                        <th mat-header-cell *matHeaderCellDef class="tableHeader" style="color: black">
                                                            Tax Preparer
                                                        </th>
                                                        <td mat-cell *matCellDef="let element" class="tableBody">
                                                            <span style="color: #64c8cc">
                                {{ element.tax_preparer_name }}</span
                              >
                            </td>
                          </ng-container>

                          <ng-container matColumnDef="document_drop_off_count">
                            <th
                              mat-header-cell
                              *matHeaderCellDef
                              class="tableHeader"
                              style="
                                background-color: rgb(129, 205, 93);
                                color: black;
                              "
                            >
                              Document Drop off
                            </th>
                            <td
                              mat-cell
                              *matCellDef="let element"
                              class="tableBody"
                            >
                              {{ element.document_drop_off_count }}
                            </td>
                          </ng-container>

                          <ng-container matColumnDef="basic_in_person_count">
                            <th
                              mat-header-cell
                              *matHeaderCellDef
                              class="tableHeader"
                              style="
                                background-color: rgb(129, 216, 201);
                                color: black;
                              "
                            >
                              Basic in Person
                            </th>
                            <td
                              mat-cell
                              *matCellDef="let element"
                              class="tableBody"
                            >
                              {{ element.basic_in_person_count }}
                            </td>
                          </ng-container>

                          <ng-container matColumnDef="advance_in_person_count">
                            <th
                              mat-header-cell
                              *matHeaderCellDef
                              class="tableHeader"
                              style="
                                background-color: rgb(94, 150, 255);
                                color: black;
                              "
                            >
                              Advance In Person
                            </th>
                            <td
                              mat-cell
                              *matCellDef="let element"
                              class="tableBody"
                            >
                              {{ element.advance_in_person_count }}
                            </td>
                          </ng-container>

                          <ng-container matColumnDef="return_visit_count">
                            <th
                              mat-header-cell
                              *matHeaderCellDef
                              class="tableHeader"
                              style="
                                background-color: rgb(129, 126, 205);
                                color: black;
                              "
                            >
                              Return Visit
                            </th>
                            <td
                              mat-cell
                              *matCellDef="let element"
                              class="tableBody"
                            >
                              {{ element.return_visit_count }}
                            </td>
                          </ng-container>

                          <ng-container matColumnDef="total_hours">
                            <th
                              mat-header-cell
                              *matHeaderCellDef
                              class="tableHeader"
                              style="
                                background-color: #c5c5c7 !important;
                                color: black;
                              "
                            >
                              Total Hours
                            </th>
                            <td
                              mat-cell
                              *matCellDef="let element"
                              class="tableBody"
                            >
                              {{ element.total_hours }}
                            </td>
                          </ng-container>

                          <ng-container matColumnDef="total_hours_booked">
                            <th
                              mat-header-cell
                              *matHeaderCellDef
                              class="tableHeader"
                              style="
                                background-color: #c5c5c7 !important;
                                color: black;
                              "
                            >
                              Total Hours Booked
                            </th>
                            <td
                              mat-cell
                              *matCellDef="let element"
                              class="tableBody"
                            >
                              {{ element.total_hours_booked }}
                            </td>
                          </ng-container>

                          <ng-container matColumnDef="booking_percentage">
                            <th
                              mat-header-cell
                              *matHeaderCellDef
                              class="tableHeader"
                              style="
                                background-color: #c5c5c7 !important;
                                color: black;
                              "
                            >
                              Booking Percentage
                            </th>
                            <td
                              mat-cell
                              *matCellDef="let element"
                              class="tableBody"
                            >
                              {{ element.booking_percentage }}
                            </td>
                          </ng-container>

                          <ng-container matColumnDef="total_hours_available">
                            <th
                              mat-header-cell
                              *matHeaderCellDef
                              class="tableHeader"
                              style="
                                background-color: #c5c5c7 !important;
                                color: black;
                                text-align: center;
                                padding-right: 0px;
                              "
                            >
                              Total Hours Available
                            </th>
                            <td
                              mat-cell
                              *matCellDef="let element"
                              class="tableBody"
                            >
                              {{ element.total_hours_available }}
                            </td>
                          </ng-container>

                          <tr
                            mat-header-row
                            *matHeaderRowDef="this.displayedColumns"
                          ></tr>
                          <tr
                            mat-row
                            *matRowDef="let row; columns: displayedColumns"
                          ></tr>
                        </table>

                        <!-- <mat-paginator
                                          *ngIf="summaryData.page$ | async as page"
                                          [length]="page.totalElements"
                                          [pageSize]="page.size"
                                          [pageIndex]="page.number"
                                          [hidePageSize]="false"
                                          (page)="summaryData.fetch($event.pageIndex)"
                                        >
                                        </mat-paginator> -->
                      </div>
                    </div>
                  </div>
                </div>
                <div
                  class="row"
                  style="align-content: center"
                  *ngIf="!isShowCalendar"
                >
                  <!-- <div class="col-md-3"></div> -->
                  <div class="col-md-4" style="display: grid">
                    <button
                      type="submit"
                      class="btn btn-primary"
                      style="height: 100px"
                      (click)="showCalendar()"
                    >
                      Schedule Appointment
                    </button>
                  </div>
                  <div class="col-md-4" style="display: grid">
                    <button
                      style="height: 100px"
                      class="btn btn-primary"
                      mat-button
                      (click)="back()"
                    >
                      Check Eligibility
                    </button>
                  </div>
                  <div class="col-md-4" style="display: grid">
                    <button
                    style="height: 100px"
                    class="btn btn-primary"
                    mat-button
                    (click)="displayCalendar()"
                  >
                    View  Calendar
                  </button>
                  </div>
                </div>

                <br />
                <div *ngIf="isShowCalendar">
                  <div [ngSwitch]="view">
                    <!--[activeDayIsOpen]="activeDayIsOpen"-->
                    <div
                      class="card-header card-header-danger"
                      style="padding: 10px; margin-bottom: 7px"
                    >
                      <h4 *ngSwitchCase="CalendarView.Month" class="card-title">
                        Monthly Schedule
                      </h4>
                      <h4 *ngSwitchCase="CalendarView.Week" class="card-title">
                        Weekly Schedule
                      </h4>
                      <h4 *ngSwitchCase="CalendarView.Day" class="card-title">
                        Day Schedule 8:00 AM - 5:00 PM
                      </h4>
                    </div>

                    <div class="container-fluid">
                      <div class="row text-right">
                        <div
                          class="col-md-8"
                          style="align-items: center; display: flex"
                        >
                          <ng-container *ngFor="let taxType of taxTypeList">
                            <span
                              style="
                                align-items: center;
                                display: flex;
                                margin: 4px;
                              "
                            >
                              <span
                                class="dot"
                                [ngStyle]="{
                                  'background-color': '#' + taxType.extra_value,
                                  margin: '4px'
                                }"
                              ></span>
                                                            <strong>{{ taxType.name + " " }}</strong>
                                                            </span>
                                                    </ng-container>
                                                    <span style="
                              align-items: center;
                              display: flex;
                              margin: 4px;
                            ">
                            <span
                              class="dot"
                              [ngStyle]="{
                                'background-color':
                                  '#f6eabe
                                                      ',
                                margin: '4px'
                              }"
                            ></span>
                                                    <strong>Fully Booked</strong>
                                                    </span>
                                            </div>
                                            <!-- <div class="col-md-4"></div> -->
                                            <div class="col-md-4">
                                                <mat-form-field class="example-full-width">
                                                    <mat-label>Tax Preparer</mat-label>
                                                    <mat-select name="tax_preparer_id">
                                                        <mat-option *ngFor="let taxPreparer of taxpreparerList" [value]="taxPreparer.preparer_id" (onSelectionChange)="
                                  selectTaxPrepare(
                                    $event,
                                    taxPreparer.preparer_id
                                  )
                                ">
                                                            {{ taxPreparer.preparer_name }}
                                                        </mat-option>
                                                    </mat-select>
                                                </mat-form-field>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="container-fluid">
                                        <div class="row text-left">
                                            <div class="col-md-12" style="align-items: center; display: flex">
                                                <!-- <ng-container *ngFor="let taxType of taxTypeList">
                                                    <span style="
                              align-items: center;
                              display: flex;
                              margin: 4px;
                            ">
                            <span
                              class="dot"
                              [ngStyle]="{
                                'background-color': '#' + taxType.extra_value,
                                margin: '4px'
                              }"
                            ></span>
                                                    <strong>{{ taxType.name + " " }}</strong>
                                                    </span>
                                                </ng-container> -->
                                            </div>
                                        </div>
                                    </div>
                                    <div class="container-fluid">
                                        <block-ui [template]="blockTemplate">
                                            <mwl-calendar-month-view *ngSwitchCase="CalendarView.Month" [viewDate]="viewDate" [events]="events" [refresh]="refresh" [activeDayIsOpen]="activeDayIsOpen" (dayClicked)="monthDayClicked($event.day)" (eventClicked)="handleEvent('Clicked', $event.event)"
                                                (eventTimesChanged)="eventTimesChanged($event)" (beforeViewRender)="
                            beforeMonthViewRender($event);
                            beforeMonthlyViewRender($event)
                          " [cellTemplate]="customCellTemplate" (columnHeaderClicked)="
                            clickedColumn = $event.isoDayNumber
                          ">
                                            </mwl-calendar-month-view>
                                            <mwl-calendar-week-view *ngSwitchCase="CalendarView.Week" precision="minutes" [viewDate]="viewDate" [events]="events" [refresh]="refresh" (dayClicked)="dayClicked($event.day)" [dayStartHour]="0" [dayEndHour]="24" [hourSegments]="6" (dayHeaderClicked)="clickedDate = $event.day.date"
                                                (hourSegmentClicked)="hourSegmentClicked($event.date)" (beforeViewRender)="beforeWeekViewRender($event)">
                                            </mwl-calendar-week-view>
                                            <mwl-calendar-day-view *ngSwitchCase="CalendarView.Day" [viewDate]="viewDate" [events]="events" [refresh]="refresh" [dayStartHour]="0" [dayEndHour]="24" [hourSegments]="2" (beforeViewRender)="beforeDayViewRender($event)" (hourSegmentClicked)="hourSegmentClicked($event.date)">
                                            </mwl-calendar-day-view>
                                        </block-ui>
                                    </div>
                                </div>
                            </div>

                            <!-- Everything you see below is just for the demo, you don't need to include it in your app -->
                        </div>
                    </div>
                </div>
            </div>
            <!--Card Body End-->
        </div>
        <!--Card End-->
    </div>
</div>
</div>